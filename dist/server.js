!function(e){var t={};function a(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=9)}([function(e,t){e.exports=require("express")},function(e,t){t.responseMiddleware=(e,t,a)=>{t.status(t.data.status).send(t.data)}},function(e,t,a){const{dbAdapter:r}=a(4),{v4:s}=a(13);t.BaseRepository=class{constructor(e){this.dbContext=r.get(e),this.collectionName=e}generateId(){return s()}getAll(){return this.dbContext.value()}getOne(e){return this.dbContext.find(e).value()}create(e){e.id=this.generateId(),e.createdAt=new Date;return this.dbContext.push(e).write().find(t=>t.id===e.id)}update(e,t){return t.updatedAt=new Date,this.dbContext.find({id:e}).assign(t).write()}delete(e){return this.dbContext.remove({id:e}).write()}}},function(e,t,a){const{BaseRepository:r}=a(2);t.UserRepository=new class extends r{constructor(){super("users")}}},function(e,t,a){const r=a(6).resolve()+"/database.json",s=a(11)(new(a(12))(r));s.defaults({users:[],fighters:[],fights:[],controls:[]}).write(),t.dbAdapter=s},function(e,t,a){const{BaseRepository:r}=a(2);t.FighterRepository=new class extends r{constructor(){super("fighters")}}},function(e,t){e.exports=require("path")},function(e,t,a){const{UserRepository:r}=a(3);e.exports=new class{search(e){const t=r.getOne(e);return t||null}get(e,t,a){try{let e=r.getAll();t.data={error:!1,data:e,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}getId(e,t,a){try{let s=e.params.id,o=r.getOne(e=>e.id==s);t.data=o?{error:!1,data:o,status:200}:{error:!0,message:"No such user ...",status:400}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}delete(e,t,a){try{let s=e.params.id,o=r.getOne(e=>e.id==s);o||(t.data={error:!0,message:"No such user found !",status:400},a()),o=r.delete(s),t.data={error:!1,data:o,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}post(e,t,a){try{if(!t.data.error){let a=r.create(e.body);t.data.data=a}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}put(e,t,a){try{if(!t.data.error){let a=t.data.data,s=r.update(a,e.body);t.data.data=s}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}}},function(e,t,a){const{BaseRepository:r}=a(2);t.FightRepository=new class extends r{constructor(){super("fights")}}},function(e,t,a){const r=a(0),s=a(10),o=a(6);a(4);const{UserRepository:i}=a(3),d=r();let n=!1;d.use(s()),d.use(r.json()),d.use(r.urlencoded({extended:!0}));a(14)(d);const u=o.resolve(__dirname+"/../clientWork/build");d.use(r.static(u)),d.get("/clientWork/buttle/*",(function(e,t){if(n){const a=o.resolve(`${__dirname}/../${e.url}`);t.sendFile(a)}else t.sendStatus(403)})),d.get("/clientWork/pages/*",(function(e,t){let a=e.params[0].split(":");n||function(e){if(e.id){let t=i.getOne(t=>t.id==e.id);n=t}return n}(e.query)?t.sendFile(o.resolve(o.resolve(`${__dirname}/../clientWork/pages/${a[0]}`))):t.sendStatus(403)}));a(34).config();const l=process.env.PORT;d.listen(l,()=>{console.log(`Server listening on port ${l} !`)}),t.app=d},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("lowdb")},function(e,t){e.exports=require("lowdb/adapters/FileSync")},function(e,t){e.exports=require("uuid")},function(e,t,a){const r=a(15),s=a(18),o=a(20),i=a(24),d=a(28),n=a(31);e.exports=e=>{e.use("/api/users",r),e.use("/api/fighters",o),e.use("/api/fights",i),e.use("/api/auth",s),e.use("/api/details",d),e.use("/api/controls",n)}},function(e,t,a){const{Router:r}=a(0),s=a(7),{createUserValid:o,updateUserValid:i}=a(16),{responseMiddleware:d}=a(1),n=r();n.get("/",s.get,d),n.get("/:id",s.getId,d),n.delete("/:id",s.delete,d),n.use("/",o),n.post("/",s.post,d),n.use("/:id",i),n.put("/:id",s.put,d),e.exports=n},function(e,t,a){const{user:r}=a(17),{UserRepository:s}=a(3);function o(e){let t="",a=Object.keys(r),s=Object.keys(e),o="";for(let e=1;e<a.length;e++)s.indexOf(a[e])<0&&(o+=a[e]+" ");""!=o&&(t="No fields in request : "+o+"\n"),o="";let i="";for(let t=0;t<s.length;t++)a.indexOf(s[t])<0&&(o+=s[t]+" "),""==e[s[t]]&&(i+="\n --- "+s[t]);return""!=o&&(t+="Extra fields in request : "+o+"\n"),""!=i&&(t+="Empty fields in request : "+i+"\n"),t}function i(e){let t="",a=!1,r=0,s=0,o=0,i="";for("+"==e.charAt(0)&&(a=!0,r=1);r<e.length;r++){switch(e.charAt(r)){case" ":case"-":break;case"(":0==o?o=1:i=e.charAt(r);break;case")":1==o?o=2:i=e.charAt(r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s++;break;default:i=e.charAt(r)}if(""!=i)break}return""!=i?t+='\n incorrect simbol "'+i+'" in phone':a&&s<12||!a&&s<10?t+="\n phone is too short":(a&&s>12||!a&&s>10)&&(t+="\n phone is too long"),t}t.createUserValid=(e,t,a)=>{try{if(e.body){let r=o(e.body);""!=r&&(t.data={error:!0,message:r,status:400},a());let d=e.body.email.indexOf("@"),n=e.body.email.substr(d+1);if(s.getOne(t=>t.firstName==e.body.firstName&&t.lastName==e.body.lastName)&&(r="\n this user is already registered : "+e.body.firstName+"  "+e.body.lastName),d<=0||""==n||n.indexOf(".")<=0)r+="\n email "+e.body.email+" is incorrect";else{s.getOne(t=>t.email==e.body.email)&&(r+="\n found user with email : "+e.body.email)}r+=i(e.body.phoneNumber),e.body.password.length<=4&&(r+="\n password is too short, 5 simb min"),t.data=""==r?{error:!1,data:"",status:200}:{error:!0,message:r,status:400}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}},t.updateUserValid=(e,t,a)=>{try{if(e.body){let r=e.params.id;s.getOne(e=>e.id==r)||(t.data={error:!0,message:"No such user found !",status:400},a());let d=o(e.body);""!=d&&(t.data={error:!0,message:d,status:400},a());let n=s.getOne(t=>t.firstName==e.body.firstName&&t.lastName==e.body.lastName);n&&n.id!=r&&(d="Such user already regictred : "+e.body.firstName+" "+e.body.lastName),""!=d&&(t.data={error:!0,message:d,status:400},a());let u=e.body.email.indexOf("@"),l=e.body.email.substr(u+1);u<=0||""==l||l.indexOf(".")<=0?d+="\n email "+e.body.email+" is incorrect":(n=s.getOne(t=>t.email==e.body.email),n&&n.id!=r&&(d+="User with such email alredy registred !")),d+=i(e.body.phoneNumber),e.body.password.length<=4&&(d+="\n password is too short, 5 simb min"),t.data=""==d?{error:!1,data:r,status:200}:{error:!0,message:d,status:400}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}}},function(e,t){t.user={id:"",firstName:"",lastName:"",email:"",phoneNumber:"",password:""}},function(e,t,a){const{Router:r}=a(0),{responseMiddleware:s}=(a(19),a(1)),{UserRepository:o}=a(3),i=r();i.post("/login",(e,t,a)=>{try{let r=o.getOne(t=>t.email==e.body.email);r&&r.password==e.body.password?t.data={error:!1,data:r,status:200}:t.data={error:!0,message:"\n Incorrect password or email !",status:400}}catch(e){t.data={error:!0,message:"Error while login ...",status:404}}finally{a()}},s),e.exports=i},function(e,t,a){const r=a(7);e.exports=new class{login(e){const t=r.search(e);if(!t)throw Error("User not found");return t}}},function(e,t,a){const{Router:r}=a(0),s=a(21),{responseMiddleware:o}=a(1),{createFighterValid:i,updateFighterValid:d}=a(22),n=r();n.get("/",s.get,o),n.get("/:id",s.getId,o),n.delete("/:id",s.delete,o),n.use("/",i),n.post("/",s.post,o),n.use("/:id",d),n.put("/:id",s.put,o),e.exports=n},function(e,t,a){const{FighterRepository:r}=a(5);e.exports=new class{get(e,t,a){try{let e=r.getAll();t.data={error:!1,data:e,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}getId(e,t,a){try{let s=e.params.id,o=r.getOne(e=>e.id==s);t.data=o?{error:!1,data:o,status:200}:{error:!0,message:"No such fighter ...",status:400}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}delete(e,t,a){try{let s=e.params.id,o=r.delete(s);t.data={error:!1,data:o,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}post(e,t,a){try{if(!t.data.error){let a=r.create(e.body);t.data.data=a}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}put(e,t,a){try{if(!t.data.error){let a=t.data.userid,s=r.update(a,e.body);t.data.data=s}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}}},function(e,t,a){const{fighter:r}=a(23),{FighterRepository:s}=a(5);function o(e){let t="",a=Object.keys(r),s=Object.keys(e),o="";for(let e=1;e<a.length;e++)s.indexOf(a[e])<0&&(o+=a[e]+" ");""!=o&&(t="No fields in request : "+o+"\n"),o="";let i="";for(let t=0;t<s.length;t++)a.indexOf(s[t])<0&&(o+=s[t]+" "),""==e[s[t]]&&(i+="\n --- "+s[t]);return""!=o&&(t+="Extra fields in request : "+o+"\n"),""!=i&&(t+="Empty fields in request : "+i+"\n"),t}function i(e,t,a,r){let s="",o="";for(let t=0;t<e.length;t++){switch(e.charAt(t)){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":break;default:o=e.charAt(t)}if(""!=o)break}return""!=o?s='\n incorrect simbol "'+o+'" in '+r:(e=Number.parseInt(e))>a?s=r+"\n is too large (mast be in "+t+" ... "+a+")":e<t&&(s=r+"\n is too small (mast be in "+t+" ... "+a+")"),s}t.createFighterValid=(e,t,a)=>{try{if(e.body){let r=o(e.body);""!=r&&(t.data={error:!0,message:r,status:400},a()),s.getOne(t=>t.name==e.body.name)?r="\n this fighter is already registered : "+e.body.name:(r=i(e.body.health,10,100,"health"),r+=i(e.body.power,1,10,"power"),r+=i(e.body.defense,1,10,"defense")),t.data=""==r?{error:!1,data:"",status:200}:{error:!0,message:r,status:400}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}},t.updateFighterValid=(e,t,a)=>{try{if(e.body){let r=e.params.id;s.getOne(e=>e.id==r)||(t.data={error:!0,message:"No such fighter found !",status:400},a());let d=o(e.body);""!=d&&(t.data={error:!0,message:d,status:400},a()),d=i(e.body.health,10,100,"health"),d+=i(e.body.power,1,10,"power"),d+=i(e.body.defense,1,10,"defense"),t.data=""==d?{error:!1,data:r,status:200}:{error:!0,message:d,status:400}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}}},function(e,t){t.fighter={id:"",name:"",health:100,power:0,defense:1}},function(e,t,a){const{Router:r}=a(0),s=a(25),{createFightValid:o,updateFightValid:i}=a(26),{responseMiddleware:d}=a(1),n=r();n.get("/",s.get,d),n.get("/:id",s.getId,d),n.delete("/:id",s.delete,d),n.use("/",o),n.post("/",s.post,d),n.use("/:id",i),n.put("/:id",s.put,d),e.exports=n},function(e,t,a){const{FightRepository:r}=a(8);e.exports=new class{get(e,t,a){try{let e=r.getAll();t.data={error:!1,data:e,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}getId(e,t,a){try{let s=e.params.id,o=r.getOne(e=>e.id==s);t.data=o?{error:!1,data:o,status:200}:{error:!0,message:"No such fight ...",status:400}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}delete(e,t,a){try{let e=t.data.userid,s=r.delete(e);t.data={error:!1,data:s,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}post(e,t,a){try{if(!t.data.error){let a=r.create(e.body);t.data.data=a}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}put(e,t,a){try{if(!t.data.error){let a=e.params.id,s=r.update(a,e.body);t.data.data=s}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}}},function(e,t,a){const{fight:r}=a(27),{FightRepository:s}=a(8);function o(e){let t="",a=Object.keys(r),s=Object.keys(e),o="";for(let e=1;e<a.length;e++)s.indexOf(a[e])<0&&(o+=a[e]+" ");""!=o&&(t="No fields in request : "+o+"\n"),o="";let i="";for(let t=0;t<s.length;t++)a.indexOf(s[t])<0&&(o+=s[t]+" "),""==e[s[t]]&&(i+="\n --- "+s[t]);return""!=o&&(t+="Extra fields in request : "+o+"\n"),""!=i&&(t+="Empty fields in request : "+i+"\n"),t}t.createFightValid=(e,t,a)=>{try{if(e.body){let r=o(e.body);""!=r&&(t.data={error:!0,message:r,status:400},a()),t.data={error:!1,data:"",status:200}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}},t.updateFightValid=(e,t,a)=>{try{let r=e.params.id;if(e.body){let s=o(e.body);""!=s&&(t.data={error:!0,message:s,status:400},a()),t.data={error:!1,data:r,status:200}}else t.data={error:!0,message:"No data in request !",status:404};a()}catch(e){t.data={error:!0,message:e,status:404},a()}}},function(e,t){t.fight={id:"",fighter1:"id",fighter2:"id",log:[]}},function(e,t,a){const{Router:r}=a(0),s=a(29),{responseMiddleware:o}=a(1),i=r();i.get("/",s.get,o),i.get("/:id",s.getId,o),i.delete("/:id",s.delete,o),i.post("/",s.post,o),i.put("/:id",s.put,o),e.exports=i},function(e,t,a){const{DetailRepository:r}=a(30);e.exports=new class{get(e,t,a){try{let e=r.getAll();t.data={error:!1,data:e,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}getId(e,t,a){try{let s=e.params.id,o=r.getOne(e=>e.id==s);t.data=o?{error:!1,data:o,status:200}:{error:!1,data:{id:s,source:""},status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}delete(e,t,a){try{let e=t.data.userid,s=r.delete(e);t.data={error:!1,data:s,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}post(e,t,a){try{let s=r.create(e.body);t.data={error:!1,data:s,status:200}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}put(e,t,a){try{let s=e.params.id,o=r.update(s,e.body);t.data={error:!1,data:o,status:200}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}}},function(e,t,a){const{dbAdapter:r}=a(4),{BaseRepository:s}=a(2),{FighterRepository:o}=a(5);t.DetailRepository=new class extends s{constructor(){super("details")}create(e){let t={id:o.getOne(t=>t.name==e.name).id,source:e.source,createdAt:new Date};return this.dbContext.push(t).write().find(e=>e.id===t.id)}update(e,t){return this.dbContext.find(t=>t.id==e).value()?(t.updatedAt=new Date,this.dbContext.find({id:e}).assign(t).write()):this.create(t)}}},function(e,t,a){const{Router:r}=a(0),s=a(32),{responseMiddleware:o}=a(1),i=r();i.get("/",s.get,o),i.post("/",s.post,o),e.exports=i},function(e,t,a){const{ControlsRepository:r}=a(33);e.exports=new class{async get(e,t,a){try{let e=await r.getOne();t.data={error:!1,data:e,status:200}}catch(e){t.data={error:!0,message:e,status:404}}finally{a()}}async post(e,t,a){try{let s=await r.getOne();if(s){const{id:t}=s;s=await r.update(t,e.body)}else s=await r.create(e.body);t.data={error:!1,data:s,status:200}}catch(e){t.data={error:!0,message:"Error while processing ...",status:404}}finally{a()}}}},function(e,t,a){const{BaseRepository:r}=a(2);t.ControlsRepository=new class extends r{constructor(){super("controls")}}},function(e,t){e.exports=require("dotenv")}]);